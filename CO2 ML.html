
<!DOCTYPE html>
<html>


<head>
  <title>ML Graph</title>
  <link href="./node_modules/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="node_modules/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
  <script src='./node_modules/dayjs/dayjs.min.js'></script>
  <script src="//unpkg.com/timelines-chart"></script>
  <script src="./node_modules/d3/dist/d3.min.js"></script>
  <script src='https://unpkg.com/simple-statistics@7.7.6/dist/simple-statistics.min.js'></script>
</head>

<body>
        <div>
            <svg id='ML'></svg>
            <script>
                
                height = 500
        
                width = 800
        
                margin = ({ top: 50, right: 150, bottom: 50, left: 50 })

                var svg = d3.select("#ML")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
                
                d3.json('data.json').then(function (data) {
                
                    var x = d3.scaleLinear()
                        .domain([d3.min(data, d => d.EV), 1100000])
                        .range([margin.left, width - margin.right]);
                    
                    var y = d3.scaleLinear()
                        .domain([d3.min(data, d => d.CO2), d3.max(data, d => d.CO2)]) // added a bit of breathing room (20,000)
                        .range([height - margin.bottom, margin.top])
                    
                    var xAxis = d3.axisBottom()
                        .scale(x);
                    
                    svg.append('g')
                        .attr('transform', `translate(0, ${height - margin.bottom})`)
                        .attr("class", "xAxis")
                        .call(xAxis);
                    
                    var yAxis = d3.axisLeft()
                        .scale(y);
                    
                    svg.append('g')
                        .attr('transform', `translate(${margin.left}, 0)`)
                        .attr("class", "yAxis")
                        .call(yAxis);
                    
                    linearRegression = ss.linearRegression(data.map(d => [d.EV, d.CO2]))
                    linearRegressionLine = ss.linearRegressionLine(linearRegression)

                    svg.selectAll('circle')
                        .data(data)
                        .enter()
                        .append('circle')
                        .attr('r', 3)
                        .attr('cx', d => x(d.EV))
                        .attr('cy', d => y(d.CO2))
                        .attr('class', 'dot');
                    
                    let line_data = [{EV: d3.min(data, d => d.EV), CO2: linearRegressionLine(d3.min(data, d => d.EV))},
                                          {EV: 1100000, CO2: linearRegressionLine(1000000)}];
                    
                    var line = d3.line()
                        .x(d => x(d.EV))
                        .y(d => y(linearRegressionLine(d.EV)));
                    
                    svg.append('path')
                        .classed('regressionLine', true)
                        .datum(line_data)
                        .attr('fill', 'none')
                        .attr('stroke', 'steelblue')
                        .attr('stroke-linejoin', 'round')
                        .attr('stroke-linecap', 'round')
                        .attr('stroke-width', 1.5)
                        .attr('d', line);
                    
                    // One red point
                    svg.append('circle')
                        .attr('r', 3)
                        .attr('cx', d => x(1000000))
                        .attr('cy', d => y(linearRegressionLine(1000000)))
                        .attr('fill', 'red');
                    
                    svg.append("text")
                      .attr("x", x(1000000)+5)
                      .attr("y", y(linearRegressionLine(1000000))-5)
                      .text(`(1000000, ${linearRegressionLine(1000000).toFixed(0)})`);

                    svg.append('circle')
                        .attr('r', 3)
                        .attr('cx', d => x(900000))
                        .attr('cy', d => y(linearRegressionLine(900000)))
                        .attr('fill', 'red');
                    
                    svg.append("text")
                      .attr("x", x(900000)+3)
                      .attr("y", y(linearRegressionLine(900000))-11)
                      .text(`(900000, ${linearRegressionLine(900000).toFixed(0)})`);
                    
                    // X axis text
                    svg.append("text")
                      .attr("x", 300)
                      .attr("y", 500)
                      .classed('label', true)
                      .attr("font-size", 20)
                      .text("Number of EV")

                    // Y axis text
                    svg.append("text")
                      .attr("x", -400)
                      .attr("y", -10)
                      .classed('label', true)
                      .attr("font-size", 20)
                      .attr("transform", "rotate(-90)")
                      .text("CO2 Emission (millions of metric tons)")

                    // Title
                    svg.append("text")
                      .attr("x", 150)
                      .attr("y", 3)
                      .classed('label', true)
                      .attr("font-size", 30)
                      .text("How Number of EV Affect CO2 Emission")
                    
                    // linear line
                    svg.append("text")
                      .attr("x", 690)
                      .attr("y", 100)
                      .classed('label', true)
                      .attr("fill", "steelblue")
                      .text(`Function: y=${linearRegression["m"].toFixed(7)}x + ${linearRegression["b"].toFixed(0)}`)
                    
                    svg.append("text")
                      .attr("x", 690)
                      .attr("y", 130)
                      .classed('label', true)
                      .attr("fill", "steelblue")
                      .text(`R Squared: ${ss.rSquared(data.map(d => [d.EV, d.CO2]), linearRegressionLine).toFixed(3)}`)
    
                })
            </script>
        </div>
</body>

</html>
