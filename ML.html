
<!DOCTYPE html>
<html>


<head>
  <title>ML Graph</title>
  <link href="./node_modules/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="node_modules/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
  <script src='./node_modules/dayjs/dayjs.min.js'></script>
  <script src="//unpkg.com/timelines-chart"></script>
  <script src="./node_modules/d3/dist/d3.min.js"></script>
  <script src='https://unpkg.com/simple-statistics@7.7.6/dist/simple-statistics.min.js'></script>
  <style>
    .chart .xAxis path,line {
      stroke: #dddddd;
    }
  
    .chart .yAxis path,line {
      stroke: #dddddd;
    }
  
    .chart circle {
      fill: #aaaaaa;
    }
  
    .chart path.regressionLine {
      stroke: #43A047;
      fill: none;
      stroke-width: 1.2;
      stroke-dasharray: 3,5;
    }
  
  </style>
</head>

<body>
        <div>
            <svg id='ML'></svg>
            <script>
                
        
                height = 500
        
                width = 700
        
                margin = ({ top: 20, right: 20, bottom: 20, left: 50 })

                var svg = d3.select("#ML")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
                
                d3.json('data.json').then(function (data) {
                
                    var x = d3.scaleLinear()
                        .domain([d3.min(data, d => d.gas_price), d3.max(data, d => d.gas_price)])
                        .range([margin.left, width - margin.right]);
                    
                    var y = d3.scaleLinear()
                        .domain([0, 20000 + d3.max(data, d => d.EV)]) // added a bit of breathing room (20,000)
                        .range([height - margin.bottom, margin.top])
                    
                    var xAxis = d3.axisBottom()
                        .scale(x);
                    
                    svg.append('g')
                        .attr('transform', `translate(0, ${height - margin.bottom})`)
                        .attr("class", "xAxis")
                        .call(xAxis);
                    
                    var yAxis = d3.axisLeft()
                        .scale(y);
                    
                    svg.append('g')
                        .attr('transform', `translate(${margin.left}, 0)`)
                        .attr("class", "yAxis")
                        .call(yAxis);
                    
                    linearRegression = ss.linearRegression(data.map(d => [d.gas_price, d.EV]))
                    linearRegressionLine = ss.linearRegressionLine(linearRegression)

                    svg.selectAll('circle')
                        .data(data)
                        .enter()
                        .append('circle')
                        .attr('r', 3)
                        .attr('cx', d => x(d.gas_price))
                        .attr('cy', d => y(d.EV))
                        .attr('class', 'dot');
                    
                    
                    var line = d3.line()
                        .x(d => x(d.gas_price))
                        .y(d => y(linearRegressionLine(d.gas_price)));
                    
                    svg.append('path')
                        .classed('regressionLine', true)
                        .datum(data)
                        .attr('fill', 'none')
                        .attr('stroke', 'steelblue')
                        .attr('stroke-linejoin', 'round')
                        .attr('stroke-linecap', 'round')
                        .attr('stroke-width', 1.5)
                        .attr('d', line);
                    
                })
            </script>
        </div>
</body>

</html>
