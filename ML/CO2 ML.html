
<!DOCTYPE html>
<html>


<head>
  <title>ML Graph</title>
  <link href="./node_modules/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- <link href="./node_modules/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet"> -->
  <!-- <script src='./node_modules/dayjs/dayjs.min.js'></script> -->
  <!-- <script src="//unpkg.com/timelines-chart"></script> -->
  <script src="./node_modules/d3/dist/d3.min.js"></script>
  <script src='https://unpkg.com/simple-statistics@7.7.6/dist/simple-statistics.min.js'></script>
  <!-- <link rel="stylesheet" href="./css_files/charts.css"> -->
</head>

<body>
        <div class="card p-3">
            <svg id='ML'></svg>
            <style>
              svg {
                background-color:whitesmoke;
                display: block;
                margin: auto;
              }

              .axis-grid line {
                stroke: rgb(187, 213, 238);
              }

              .axis-x path {
                stroke: #000;
              }
            </style>
            <script>
        
                var margin = ({top: 20, right: 40, bottom: 40, left: 30}),
                    width = 1000,
                    height = 500;

                var svg = d3.select("#ML")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
                
                d3.json('data.json').then(function (data) {
                
                    var x = d3.scaleLinear()
                        .domain([d3.min(data, d => d.EV), 1100000])
                        .range([margin.left, width - margin.right]);
                    
                    var y = d3.scaleLinear()
                        .domain([d3.min(data, d => d.CO2), d3.max(data, d => d.CO2)]) // added a bit of breathing room (20,000)
                        .range([height - margin.bottom, margin.top])
                    
                    var xAxis = d3.axisBottom(x);

                    // This is for the x axis grid
                    svg.append('g')
                      .attr("class", "x axis-grid")
                      .attr("transform", `translate(0, ${height - margin.bottom})`)
                      .call(d3.axisBottom(x).tickSize(-440).tickFormat('').ticks(10));
                    
                    // This is for x axis
                    svg.append('g')
                        .attr("class", "x axis-grid")
                        .attr('transform', `translate(0, ${height - margin.bottom})`)
                        .call(xAxis);
                    
                    var yAxis = d3.axisLeft().scale(y);
                    
                    // This is for y axis grid
                    svg.append("g")
                          .attr("class", "y axis-grid")
                          .attr("transform", `translate(${margin.left}, 0)`)
                          .call(d3.axisLeft(y).tickSize(-width).tickFormat('').ticks(10));
                    
                    // This is for y axis
                    svg.append('g')
                        .attr('transform', `translate(${margin.left}, 0)`)
                        .attr("class", "yAxis")
                        .call(yAxis);

                    svg.append('line')
                        .attr("x", 300)
                        .attr("y", 100)
                        .attr("stroke", 2);

                    linearRegression = ss.linearRegression(data.map(d => [d.EV, d.CO2]))
                    linearRegressionLine = ss.linearRegressionLine(linearRegression)

                    svg.selectAll('circle')
                        .data(data)
                        .enter()
                        .append('circle')
                        .attr('r', 3)
                        .attr('cx', d => x(d.EV))
                        .attr('cy', d => y(d.CO2))
                        .attr('class', 'dot');
                    
                    let line_data = [{EV: d3.min(data, d => d.EV), CO2: linearRegressionLine(d3.min(data, d => d.EV))},
                                          {EV: 1100000, CO2: linearRegressionLine(1000000)}];
                    
                    var line = d3.line()
                        .x(d => x(d.EV))
                        .y(d => y(linearRegressionLine(d.EV)));
                    
                    svg.append('path')
                        .classed('regressionLine', true)
                        .datum(line_data)
                        .attr('fill', 'none')
                        .attr('stroke', 'steelblue')
                        .attr('stroke-linejoin', 'round')
                        .attr('stroke-linecap', 'round')
                        .attr('stroke-width', 1.5)
                        .attr('d', line);
                    
                    // One red point
                    svg.append('circle')
                        .attr('r', 5)
                        .attr('cx', d => x(1000000))
                        .attr('cy', d => y(linearRegressionLine(1000000)))
                        .attr('fill', 'red');
                    
                    svg.append("text")
                      .attr("x", x(1000000)+5)
                      .attr("y", y(linearRegressionLine(1000000))-5)
                      .text(`(1000000, ${linearRegressionLine(1000000).toFixed(0)})`);

                    svg.append('circle')
                        .attr('r', 5)
                        .attr('cx', d => x(900000))
                        .attr('cy', d => y(linearRegressionLine(900000)))
                        .attr('fill', 'red');
                    
                    svg.append("text")
                      .attr("x", x(900000)+3)
                      .attr("y", y(linearRegressionLine(900000))-11)
                      .text(`(900000, ${linearRegressionLine(900000).toFixed(0)})`);
                    
                    // X axis text
                    svg.append("text")
                      .attr("x", width/2)
                      .attr("y", 500)
                      .classed('label', true)
                      .attr("font-size", 20)
                      .text("Number of EV")

                    // Y axis text
                    svg.append("text")
                      .attr("x", -400)
                      .attr("y", -10)
                      .classed('label', true)
                      .attr("font-size", 20)
                      .attr("transform", "rotate(-90)")
                      .text("CO2 Emission (millions of metric tons)")

                    // Title
                    svg.append("text")
                      .attr("x", 250)
                      .attr("y", 3)
                      .classed('label', true)
                      .attr("font-size", 30)
                      .text("How Number of EV Affect CO2 Emission")
                    
                    // linear line
                    svg.append("text")
                      .attr("x", 690)
                      .attr("y", 100)
                      .classed('label', true)
                      .attr("fill", "steelblue")
                      .attr("font-weight", "bold")
                      .text(`Function: y = ${linearRegression["m"].toFixed(7)}x + ${linearRegression["b"].toFixed(0)}`);
                    
                    svg.append("rect")
                      .attr("width", 285)
                      .attr("height", 70)
                      .attr("x", 680)
                      .attr("y", 75)
                      .attr("fill", "none")
                      .attr("stroke", "red")
                      .attr("stroke-width", 2);
                      // .text(`Function: y=${linearRegression["m"].toFixed(7)}x + ${linearRegression["b"].toFixed(0)}`)
                    
                    svg.append("text")
                      .attr("x", 690)
                      .attr("y", 130)
                      .classed('label', true)
                      .attr("fill", "steelblue")
                      .attr("font-weight", "bold")
                      .text(`R Squared: ${ss.rSquared(data.map(d => [d.EV, d.CO2]), linearRegressionLine).toFixed(3)}`);
    
                })
            </script>
        </div>
</body>

</html>
